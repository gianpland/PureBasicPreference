<html><head><title>OnError.pb</title></head>
<body bgcolor="#FFFFDF" link="#009999" vlink="#006666" alink="#006666">
<pre><font face="Courier New, Courier, mono"size="2"><font color="#006666">;
</font><font color="#006666">; ------------------------------------------------------------
</font><font color="#006666">;
</font><font color="#006666">;   PureBasic - OnError example file
</font><font color="#006666">;
</font><font color="#006666">;    (c) Fantaisie Software
</font><font color="#006666">;
</font><font color="#006666">; ------------------------------------------------------------
</font><font color="#006666">;
</font> 
<b><font color="#006666">Procedure</font></b> <font color="#006666">ErrorHandler</font>()
 
  ErrorMessage$ = "A program error was detected:" +<font color="#006666"> Chr</font>(13) 
  ErrorMessage$ +<font color="#006666"> Chr</font>(13)
  ErrorMessage$ + "Error Message:   " +<font color="#006666"> ErrorMessage</font>()      +<font color="#006666"> Chr</font>(13)
  ErrorMessage$ + "Error Code:      " +<font color="#006666"> Str</font>(<font color="#006666">ErrorCode</font>())    +<font color="#006666"> Chr</font>(13)  
  ErrorMessage$ + "Code Address:    " +<font color="#006666"> Str</font>(<font color="#006666">ErrorAddress</font>()) +<font color="#006666"> Chr</font>(13)
 
  <b><font color="#006666">If</font></b> <font color="#006666">ErrorCode</font>() = <font color="#924B72">#PB_OnError_InvalidMemory</font>   
    ErrorMessage$ + "Target Address:  " +<font color="#006666"> Str</font>(<font color="#006666">ErrorTargetAddress</font>()) +<font color="#006666"> Chr</font>(13)
  <b><font color="#006666">EndIf</font></b>
 
  <b><font color="#006666">If</font></b> <font color="#006666">ErrorLine</font>() = -1
    ErrorMessage$ + "Sourcecode line: Enable OnError lines support to get code line information." +<font color="#006666"> Chr</font>(13)
  <b><font color="#006666">Else</font></b>
    ErrorMessage$ + "Sourcecode line: " +<font color="#006666"> Str</font>(<font color="#006666">ErrorLine</font>()) +<font color="#006666"> Chr</font>(13)
    ErrorMessage$ + "Sourcecode file: " +<font color="#006666"> ErrorFile</font>() +<font color="#006666"> Chr</font>(13)
  <b><font color="#006666">EndIf</font></b>
 
  ErrorMessage$ +<font color="#006666"> Chr</font>(13)
  ErrorMessage$ + "Register content:" +<font color="#006666"> Chr</font>(13)
 
  <b><font color="#006666">CompilerSelect</font></b> <font color="#924B72">#PB_Compiler_Processor</font> 
    <b><font color="#006666">CompilerCase</font></b> <font color="#924B72">#PB_Processor_x86</font>
      ErrorMessage$ + "EAX = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_EAX</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "EBX = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_EBX</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "ECX = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_ECX</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "EDX = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_EDX</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "EBP = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_EBP</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "ESI = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_ESI</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "EDI = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_EDI</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "ESP = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_ESP</font>)) +<font color="#006666"> Chr</font>(13)
 
    <b><font color="#006666">CompilerCase</font></b> <font color="#924B72">#PB_Processor_x64</font>
      ErrorMessage$ + "RAX = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_RAX</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "RBX = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_RBX</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "RCX = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_RCX</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "RDX = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_RDX</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "RBP = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_RBP</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "RSI = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_RSI</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "RDI = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_RDI</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "RSP = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_RSP</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "Display of registers R8-R15 skipped."         +<font color="#006666"> Chr</font>(13)
 
    <b><font color="#006666">CompilerCase</font></b> <font color="#924B72">#PB_Processor_PowerPC</font>
      ErrorMessage$ + "r0 = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_r0</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "r1 = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_r1</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "r2 = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_r2</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "r3 = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_r3</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "r4 = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_r4</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "r5 = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_r5</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "r6 = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_r6</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "r7 = " +<font color="#006666"> Str</font>(<font color="#006666">ErrorRegister</font>(<font color="#924B72">#PB_OnError_r7</font>)) +<font color="#006666"> Chr</font>(13)
      ErrorMessage$ + "Display of registers r8-R31 skipped."       +<font color="#006666"> Chr</font>(13)
 
  <b><font color="#006666">CompilerEndSelect</font></b>
 
<font color="#006666">  MessageRequester</font>("OnError example", ErrorMessage$)
  <b><font color="#006666">End</font></b>
 
<b><font color="#006666">EndProcedure</font></b>
 
<font color="#006666">; Setup the error handler.
</font><font color="#006666">;
</font><font color="#006666">OnErrorCall</font>(@ErrorHandler())
 
<font color="#006666">MessageRequester</font>("OnError example", "Executing some code with errors. The debugger should be turned off.")
 
 
<font color="#006666">; Write to protected memory
</font><font color="#006666">;
</font><font color="#006666">PokeS</font>(123, "The quick brown fox jumped over the lazy dog.")
 
<font color="#006666">; Division by zero
</font><font color="#006666">;
</font>a = 0
a = 1 / a
 
<font color="#006666">; Generate an error manually
</font><font color="#006666">;
</font><font color="#006666">RaiseError</font>(<font color="#924B72">#PB_OnError_IllegalInstruction</font>)
 
 
<font color="#006666">; This should not be displayed
</font><font color="#006666">;
</font><font color="#006666">MessageRequester</font>("OnError example", "Execution finished normally.")
<b><font color="#006666">End</font></b>
</font></pre>
</body></html>
